<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>مثال عملي — Offcanvas + Data Store</title>

  <!-- Bootstrap RTL CSS من CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.rtl.min.css">

  <style>
    body { background:#0e1016; color:#fff; }
    .card { background:#141824; border-color:#20263a; }
    .offcanvas { background:#11131a; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: .9rem; }
    .badge-opt { font-size:.8rem; }
  </style>
</head>
<body>

<div class="container py-4">
  <h1 class="mb-3">Offcanvas + Data Store (Bootstrap 5.2.3)</h1>
  <p class="text-muted">مثال يبيّن: استدعاء Data API، التحكم البرمجي، الأحداث، وقراءة الـ instance المخزّن عبر <code>bootstrap.Offcanvas.getOrCreateInstance</code>.</p>

  <div class="row g-4">
    <!-- بطاقة 1: Data API -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">1) Data API</h5>
          <p class="card-text">زر يستعمل <code>data-bs-toggle</code> و <code>data-bs-target</code> لفتح الـ Offcanvas مباشرة بدون كود JS إضافي.</p>
          <div class="d-flex gap-2">
            <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#ocDataApi">
              فتح — Data API
            </button>
            <span class="badge bg-dark badge-opt">backdrop: <b>true</b></span>
            <span class="badge bg-dark badge-opt">keyboard: <b>true</b></span>
            <span class="badge bg-dark badge-opt">scroll: <b>false</b></span>
          </div>
        </div>
      </div>
    </div>

    <!-- بطاقة 2: تحكم برمجي + خيارات -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">2) تحكم برمجي + خيارات</h5>
          <p class="card-text">مثال يفعّل Offcanvas برمجياً مع خيارات <code>backdrop: "static"</code> و <code>keyboard: false</code> و <code>scroll: true</code>.</p>
          <div class="d-flex gap-2">
            <button id="openProg" class="btn btn-success">فتح</button>
            <button id="closeProg" class="btn btn-secondary">إغلاق</button>
            <button id="toggleProg" class="btn btn-outline-info">تبديل</button>
          </div>
          <div class="mt-3">
            <span class="badge bg-dark badge-opt">backdrop: <b>"static"</b></span>
            <span class="badge bg-dark badge-opt">keyboard: <b>false</b></span>
            <span class="badge bg-dark badge-opt">scroll: <b>true</b></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <hr class="my-4 border-secondary">

  <div class="row g-4">
    <!-- بطاقة 3: قراءة الـ instance -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">3) قراءة الـ Instance (Data Store)</h5>
          <p class="card-text">
            بعد إنشاء الـ Offcanvas، نقرأ الـ instance المخزّن باستخدام:
            <code>bootstrap.Offcanvas.getOrCreateInstance(element)</code>.
          </p>
          <div class="d-flex gap-2">
            <button id="readInstanceBtn" class="btn btn-warning">اقرأ معلومات الـ Instance</button>
          </div>
          <pre class="log mt-3 p-3 bg-dark rounded-3" id="instanceLog">اضغط الزر لعرض معلومات الـ instance…</pre>
        </div>
      </div>
    </div>

    <!-- بطاقة 4: لوق الأحداث -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">4) لوق الأحداث</h5>
          <p class="card-text">نستمع إلى <code>show/hide/shown/hidden</code> لكلا الـ Offcanvas ونعرضها هنا.</p>
          <pre class="log mt-3 p-3 bg-dark rounded-3" id="eventLog">هنا تُعرض الأحداث…</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Offcanvas (1) — Data API -->
<div id="ocDataApi" class="offcanvas offcanvas-start" tabindex="-1" aria-labelledby="ocDataApiLabel">
  <div class="offcanvas-header">
    <h5 id="ocDataApiLabel" class="offcanvas-title">Offcanvas — Data API</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>هذا المثال يستخدم Data API فقط.</p>
    <p class="text-muted">الخلفية <code>backdrop</code> فعالة، والكيبورد يمكّن إغلاق ESC.</p>
    <ul class="list-unstyled">
      <li><a class="link-light" href="#">رابط 1</a></li>
      <li><a class="link-light" href="#">رابط 2</a></li>
      <li><a class="link-light" href="#">رابط 3</a></li>
    </ul>
  </div>
</div>

<!-- Offcanvas (2) — تحكم برمجي -->
<div id="ocProg" class="offcanvas offcanvas-end" tabindex="-1" aria-labelledby="ocProgLabel">
  <div class="offcanvas-header">
    <h5 id="ocProgLabel" class="offcanvas-title">Offcanvas — تحكم برمجي</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>هذا المثال يُنشّط برمجياً مع الخيارات المذكورة.</p>
    <p class="text-muted">الخلفية <code>static</code> تعني أن الضغط على الخلفية لا يغلق اللوحة.</p>
    <p class="text-muted">تعطيل <code>keyboard=false</code> يعطّل إغلاق ESC.</p>
  </div>
</div>

<!-- Bootstrap Bundle (يتضمن Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // أداة لوق صغيرة
  function appendLog(el, msg) {
    const time = new Date().toLocaleTimeString();
    el.textContent = `[${time}] ${msg}
` + el.textContent;
  }

  document.addEventListener('DOMContentLoaded', () => {
    // عناصر اللوق
    const eventLog = document.getElementById('eventLog');
    const instanceLog = document.getElementById('instanceLog');

    // (2) إنشاء تحكم برمجي
    const ocProgEl = document.getElementById('ocProg');
    const ocProg = new bootstrap.Offcanvas(ocProgEl, {
      backdrop: 'static',
      keyboard: false,
      scroll: true
    });

    document.getElementById('openProg').addEventListener('click', () => ocProg.show());
    document.getElementById('closeProg').addEventListener('click', () => ocProg.hide());
    document.getElementById('toggleProg').addEventListener('click', () => ocProg.toggle());

    // (1) Data API + (2) تحكم برمجي — ربط أحداث
    const offcanvases = [document.getElementById('ocDataApi'), ocProgEl];
    offcanvases.forEach(el => {
      el.addEventListener('show.bs.offcanvas',   () => appendLog(eventLog, el.id + ': show'));
      el.addEventListener('shown.bs.offcanvas',  () => appendLog(eventLog, el.id + ': shown'));
      el.addEventListener('hide.bs.offcanvas',   () => appendLog(eventLog, el.id + ': hide'));
      el.addEventListener('hidden.bs.offcanvas', () => appendLog(eventLog, el.id + ': hidden'));
    });

    // (3) قراءة الـ instance المخزّن (Data Store)
    // بالنسبة لـ ocDataApi سيُنشأ instance تلقائيًا عند أول استخدام Data API
    document.getElementById('readInstanceBtn').addEventListener('click', () => {
      const ocDataApiEl = document.getElementById('ocDataApi');
      const inst1 = bootstrap.Offcanvas.getOrCreateInstance(ocDataApiEl); // قد ينشئه الآن إذا لم يكن موجودًا
      const inst2 = bootstrap.Offcanvas.getOrCreateInstance(ocProgEl);    // موجود مسبقًا

      const snapshot = {
        ocDataApi: {
          isShown: ocDataApiEl.classList.contains('show'),
          hasAriaModal: ocDataApiEl.getAttribute('aria-modal') === 'true',
        },
        ocProg: {
          isShown: ocProgEl.classList.contains('show'),
          hasAriaModal: ocProgEl.getAttribute('aria-modal') === 'true',
        }
      };

      instanceLog.textContent = JSON.stringify(snapshot, null, 2);
    });
  });
</script>

</body>
</html>
